#:kivy 2.2.1
#
ScreenManager:
  MenuScreen:
  SelectionScreen:
  TrainingScreen:
  SettingScreen:
  CustomScreen:
<MenuScreen>:
  name: 'menu'
  FloatLayout:
    canvas:
      Color:
        rgb: 0.6, 0.8, 0.8
      Rectangle:
        size: self.size

    FloatLayout:
      size_hint: 1, 0.3
      pos_hint: {'top': 1}

      Label:
        size: self.texture_size
        text: "Taichine" 
        font_name: 'SEVESBRG'
        font_size: self.height
        italic: True
        size_hint: 1, 0.8
        pos_hint: {'center_x': 0.5, 'center_y': 0.4}

      Label:
        size: self.texture_size
        text:"Your personal Tai Chi trainer" 
        font_name: 'SEVESBRG'
        font_size: self.height * 0.5
        italic: True
        size_hint: 1, 0.3
        pos_hint: {'center_x': 0.5, 'center_y': 0.85}

    BoxLayout:
      canvas:
        Color:
          rgb: 0.2, 0.2, 0.2
        Rectangle:
          size: self.size

      orientation: 'vertical'
      padding: 10
      spacing: 10
      size_hint: 1, 0.7
      pos_hint: {'y': 0}

      Button:
        height: 110
        text_size: None, None
        font_size: 40
        text: 'Pose Selection'
        bold: True
        on_press:  
          root.manager.get_screen('selection').set_all()
          root.manager.transition.direction = 'left'
          root.manager.current = 'selection'

      Button:
        height: 110
        text_size: None, None
        font_size: 40
        text: 'Custom Poses Upload'
        bold: True
        on_press:
          root.manager.transition.direction = 'left'
          root.manager.current = 'custom'
        on_press:
          root.manager.transition.direction = 'left'
          root.manager.current = 'custom'

      Button:
        height: 110
        text_size: None, None
        font_size: 40
        text: 'Options'
        bold: True
        on_press:  
          root.manager.transition.direction = 'left'
          root.manager.current = 'setting'

      Button:
        height: 110
        text_size: None, None
        font_size: 40
        text: 'Quit'
        bold: True
        on_press: App.get_running_app().stop()

<TrainingScreen>:
  name: 'training'
  FloatLayout:
    canvas:
      Color:
        rgb: 0.6, 0.8, 0.8
      Rectangle:
        size: self.size
    
    FloatLayout:
      size_hint: 1, 0.2
      pos_hint: {'top': 1, 'center_x': 0.5}

      Label:
        text: 'Your score: 100'
        color: 1, 1, 1, 1
        font_name: 'SEVESBRG'      
        size: self.texture_size
        font_size: self.height * 0.5
        pos_hint: {'center_y': 0.3, 'center_x': 0.5}
        bold: True

      Button:
        text: 'Back'
        color: 1, 1, 1, 1
        size_hint: 0.15, 0.8
        font_size: self.height * 0.35
        pos_hint: {'center_y': 0.5, 'center_x': 0.1}
        on_press: 
          root.manager.transition.direction = 'right'
          root.manager.current = 'selection'

      Button:
        id: capture
        text: 'Capture'
        color: 1, 1, 1, 1
        size_hint: 0.15, 0.8
        font_size: self.height * 0.35
        pos_hint: {'center_y': 0.5, 'center_x': 0.9}
        on_press: root.capture()

    BoxLayout:
      canvas:
        Color:
          rgb: 0.4, 0.4, 0.4
        Rectangle:
          size: self.size        
      orientation: 'vertical'
      size_hint: 1, 0.8
      pos_hint: {'y': 0}

      BoxLayout:      
        size_hint: 1, 0.5
        pos_hint: {'top': 1}
        orientation: 'horizontal'
        padding: 10
        spacing: 30

        Camera:
          id: camera
          size_hint: 0.45, 1
          resolution: (640, 480)
          play: True
        
        Image:
          id: reference_image
          size_hint: 0.45, 1
          keep_ratio: True

      BoxLayout: 
        size_hint: 1, 0.5
        pos_hint: {'y': 0}
        orientation: 'horizontal'
        padding: 10
        spacing: 10

        Image:
          source: 'image0.png'
          keep_ratio: True

<SettingScreen>:
  name: 'setting'
  FloatLayout:
    canvas:
      Color:
        rgb: 0.6, 0.8, 0.8
      Rectangle:
        size: self.size

    FloatLayout:
      size_hint: 1, 0.2
      pos_hint: {'top': 1, 'center_x': 0.5}

      Label:
        text: 'Setting'
        color: 1, 1, 1, 1
        font_name: 'SEVESBRG'      
        size: self.texture_size
        font_size: self.height * 0.5
        pos_hint: {'center_y': 0.3, 'center_x': 0.5}
        bold: True

      Button:
        text: 'Back'
        color: 1, 1, 1, 1
        size_hint: 0.15, 0.25
        font_size: self.height * 0.35
        pos_hint: {'center_y': 0.8, 'center_x': 0.1}
        bold: True
        on_press: 
          root.manager.transition.direction = 'right'
          root.manager.current = 'menu'        
    
    GridLayout:
      canvas:
        Color:
          rgb: 0.8, 0.8, 0.8
        Rectangle:
          size: self.size
      cols: 2
      rows: 2
      size_hint: 1, 0.8
      pos_hint: {'center_x': 0.5, 'bottom': 0}
      padding: 50

      Label:
        text: 'Volume'
        color: 0, 0, 0, 1
        size_hint: 0.8, 0.2
        font_size: self.width * 0.1
        width: 80

      Slider:
        id: volume_slider
        min: 0
        max: 10
        step: 1
        orientation: 'horizontal'

      Label:
        text: 'Sensitivity'
        color: 0, 0, 0, 1
        size_hint: 0.8, 0.2
        font_size: self.width * 0.1
        width: 80

      Slider:
        id: sensitivity_slider
        min: 0
        max: 10
        step: 1
        orientation: 'horizontal'

<SelectionScreen>:
  name: 'selection'
  FloatLayout:
    canvas:
      Color:
        rgb: 0.6, 0.8, 0.8
      Rectangle:
        size: self.size

    FloatLayout:
      size_hint: 1, 0.2
      pos_hint: {'top': 1, 'center_x': 0.5}

      Label:
        text: 'Selection Your Training'
        color: 1, 1, 1, 1
        font_name: 'SEVESBRG'      
        size: self.texture_size
        font_size: self.height * 0.5
        pos_hint: {'center_y': 0.3, 'center_x': 0.5}
        bold: True
      
      Button:
        text: 'Back'
        color: 1, 1, 1, 1
        size_hint: 0.15, 0.25
        font_size: self.height * 0.35
        pos_hint: {'center_y': 0.8, 'center_x': 0.1}
        bold: True
        on_press: 
          root.manager.transition.direction = 'right'
          root.manager.current = 'menu'
    
    FloatLayout:
      canvas:
        Color:
          rgb: 0.8, 0.8, 0.8
        Rectangle:
          size: self.size
      size_hint: 1, 0.8
      pos_hint: {'y': 0, 'center_x': 0.5}


    ScrollView:
      size_hint: 1, 0.8

      GridLayout:
        id: menu_grid
        canvas:
          Color:
            rgb: 0.2, 0.2, 0.2
          Rectangle:
            size: self.size
        cols: 1
        spacing: 10
        size_hint: 1, None
        pos_hint: {'bottom': 0, 'center_x': 0.5}

<CustomScreen>:
  name:'custom'
  FloatLayout:
    canvas:
      Color:
        rgb: 0.6, 0.8, 0.8
      Rectangle:
        size: self.size

    FloatLayout:
      size_hint: 1, 0.2
      pos_hint: {'y': 0.8, 'center_x': 0.5}

      Label:
        text: 'Upload'
        color: 1, 1, 1, 1
        font_name: 'SEVESBRG'      
        size: self.texture_size
        font_size: self.height * 0.5
        pos_hint: {'center_y': 0.3, 'center_x': 0.5}
        bold: True
      
      Button:
        text: 'Back'
        color: 1, 1, 1, 1
        size_hint: 0.15, 0.25
        font_size: self.height * 0.35
        pos_hint: {'center_y': 0.8, 'center_x': 0.1}
        bold: True
        on_press: 
          root.manager.transition.direction = 'right'
          root.manager.current = 'menu'

    BoxLayout:
      canvas:
        Color:
          rgb: 0.8, 0.8, 0.8
        Rectangle:
          size: self.size      
      orientation: "vertical"
      size_hint: 1, 0.8
      pos_hint: {'y': 0, 'center_x': 0.5}
      
      canvas.before:
        Rectangle:
          pos: self.pos
          size: self.size
          Color:
            rgba: 1, 1, 1, 1
      
      padding: 50
      spacing: 20

      Label:
        text: "Please Upload a Custom Pose!"
        font_size: 32
        color: 0, 0, 0, 1
      
      FloatLayout:
        size_hint: 0.5, 0.5
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

        Button:
          id: upload_button
          size_hint: 1, 1
          pos_hint: {'center_x': 0.5, 'center_y': 0.5}
          background_color: 255,255,255,1
          # background_normal: 'icons/file-upload_white.png'
          on_press: 
            # root.manager.current = "selection_screen"
            root.select_file()
              
        Image:
          id: button_image
          size_hint: 1, 1
          pos_hint: {'center_x': 0.5, 'center_y': 0.5}
          source: "icons/file-upload_white.png"
            
<PoseItem@ButtonBehavior+BoxLayout>:
  canvas:
    Color:
      rgb: 0.2, 0.2, 0.2
    Rectangle:
      size: self.size
  orientation: 'horizontal'
  padding: 10
  spacing: 10  
  size_hint: 1, None
  height: 80   
  on_press: 
    current_screen = root.parent.parent.parent.parent
    current_screen.manager.get_screen('training').set_reference_image(root.id, '1')
    current_screen.manager.transition.direction = 'left'
    current_screen.manager.current = 'training'  
    
  Image:
    size_hint: 0.15, 1
    source: root.image
  Label:
    size_hint: 0.85, 1
    text: root.label